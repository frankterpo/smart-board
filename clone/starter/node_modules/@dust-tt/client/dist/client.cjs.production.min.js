"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("eventsource-parser"),t=require("moment-timezone"),r=require("zod"),n=require("event-source-polyfill");function o(e,t){this.v=e,this.k=t}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t,r,n,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function i(e){a(s,n,o,i,c,"next",e)}function c(e){a(s,n,o,i,c,"throw",e)}i(void 0)}))}}function c(e){return new o(e,0)}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(null,arguments)}function p(){p=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",i=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var s=Object.create((t&&t.prototype instanceof f?t:f).prototype),a=new j(n||[]);return o(s,"_invoke",{value:T(e,r,a)}),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var z="suspendedStart",h="suspendedYield",m="executing",g="completed",b={};function f(){}function v(){}function y(){}var x={};u(x,a,(function(){return this}));var I=Object.getPrototypeOf,S=I&&I(I(C([])));S&&S!==r&&n.call(S,a)&&(x=S);var E=y.prototype=f.prototype=Object.create(x);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,s,a,i){var c=d(e[o],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,i)}),(function(e){r("throw",e,a,i)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,i)}))}i(c.arg)}var s;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return s=s?s.then(o,o):o()}})}function T(t,r,n){var o=z;return function(s,a){if(o===m)throw Error("Generator is already running");if(o===g){if("throw"===s)throw a;return{value:e,done:!0}}for(n.method=s,n.arg=a;;){var i=n.delegate;if(i){var c=R(i,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===z)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?g:h,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function R(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var s=d(o,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,b;var a=s.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=y,o(E,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:v,configurable:!0}),v.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},_(A.prototype),u(A.prototype,i,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,o,s){void 0===s&&(s=Promise);var a=new A(l(e,r,n,o),s);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(E),u(E,c,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}function d(e){return function(){return new z(e.apply(this,arguments))}}function z(e){var t,r;function n(t,r){try{var a=e[t](r),i=a.value,c=i instanceof o;Promise.resolve(c?i.v:i).then((function(r){if(c){var o="return"===t?"return":"next";if(!i.k||r.done)return n(o,r);r=e[o](r).value}s(a.done?"return":"normal",r)}),(function(e){n("throw",e)}))}catch(e){s("throw",e)}}function s(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,o){return new Promise((function(s,a){var i={key:e,arg:o,resolve:s,reject:a,next:null};r?r=r.next=i:(t=r=i,n(e,o))}))},"function"!=typeof e.return&&(this.return=void 0)}z.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},z.prototype.next=function(e){return this._invoke("next",e)},z.prototype.throw=function(e){return this._invoke("throw",e)},z.prototype.return=function(e){return this._invoke("return",e)};var h=r.z.enum(["ActionBrainIcon","ActionCloudArrowLeftRightIcon","ActionDocumentTextIcon","ActionEmotionLaughIcon","ActionGitBranchIcon","ActionGlobeAltIcon","ActionImageIcon","ActionLightbulbIcon","ActionLockIcon","ActionMagnifyingGlassIcon","ActionRobotIcon","ActionScanIcon","ActionTableIcon","ActionTimeIcon","CommandLineIcon","GcalLogo","GmailLogo","GithubLogo","GoogleSpreadsheetLogo","HubspotLogo","FreshserviceLogo","MondayLogo","OutlookLogo","JiraLogo","LinearLogo","NotionLogo","SalesforceLogo","SlackLogo","StripeLogo"]),m=r.z.enum(["ActionArmchairIcon","ActionArrowDownOnSquareIcon","ActionArrowUpOnSquareIcon","ActionAttachmentIcon","ActionBankIcon","ActionBarcodeIcon","ActionBeerIcon","ActionBookOpenIcon","ActionBracesIcon","ActionBrainIcon","ActionBriefcaseIcon","ActionBuildingIcon","ActionCalculatorIcon","ActionCalendarIcon","ActionCalendarCheckIcon","ActionCameraIcon","ActionCarIcon","ActionCardIcon","ActionCheckCircleIcon","ActionClipboardIcon","ActionCloudArrowDownIcon","ActionCloudArrowLeftRightIcon","ActionCloudArrowUpIcon","ActionCodeBlockIcon","ActionCodeBoxIcon","ActionCommandIcon","ActionCommand1Icon","ActionCommunityIcon","ActionCompanyIcon","ActionCubeIcon","ActionCupIcon","ActionCustomerServiceIcon","ActionDashboardIcon","ActionDatabaseIcon","ActionDocumentIcon","ActionDocumentPileIcon","ActionDocumentPlusIcon","ActionDocumentTextIcon","ActionDoubleQuotesIcon","ActionEmotionLaughIcon","ActionExternalLinkIcon","ActionEyeIcon","ActionEyeSlashIcon","ActionFilmIcon","ActionFilterIcon","ActionFingerprintIcon","ActionFireIcon","ActionFlagIcon","ActionFlightLandIcon","ActionFlightTakeoffIcon","ActionFolderIcon","ActionFolderAddIcon","ActionFolderOpenIcon","ActionFullscreenIcon","ActionFullscreenExitIcon","ActionGamepadIcon","ActionGitBranchIcon","ActionGitForkIcon","ActionGlobeIcon","ActionGlobeAltIcon","ActionGraduationCapIcon","ActionHandHeartIcon","ActionHandThumbDownIcon","ActionHandThumbUpIcon","ActionHeartIcon","ActionHomeIcon","ActionHospitalIcon","ActionImageIcon","ActionInboxIcon","ActionIncludeIcon","ActionLayoutIcon","ActionLightbulbIcon","ActionListIcon","ActionListCheckIcon","ActionLockIcon","ActionLogoutIcon","ActionMagicIcon","ActionMagnifyingGlassIcon","ActionMailIcon","ActionMailAiIcon","ActionMailCloseIcon","ActionMapIcon","ActionMapPinIcon","ActionMarkPenIcon","ActionMedalIcon","ActionMegaphoneIcon","ActionMenuIcon","ActionMicIcon","ActionMoonIcon","ActionMovieIcon","ActionNumbersIcon","ActionPaintIcon","ActionPencilSquareIcon","ActionPieChartIcon","ActionPinDistanceIcon","ActionPingPongIcon","ActionPlanetIcon","ActionPlusIcon","ActionPlusCircleIcon","ActionPrinterIcon","ActionPushpinIcon","ActionRainbowIcon","ActionRobotIcon","ActionRocketIcon","ActionSafeIcon","ActionSaveIcon","ActionScalesIcon","ActionScanIcon","ActionSeedlingIcon","ActionServerIcon","ActionShakeHandsIcon","ActionShipIcon","ActionShirtIcon","ActionShoppingBasketIcon","ActionSlideshowIcon","ActionSparklesIcon","ActionSquare3Stack3DIcon","ActionStopSignIcon","ActionStoreIcon","ActionSunIcon","ActionSwordIcon","ActionTableIcon","ActionTagIcon","ActionTestTubeIcon","ActionTimeIcon","ActionTrainIcon","ActionTranslateIcon","ActionTrashIcon","ActionTrophyIcon","ActionTShirtIcon","ActionUmbrellaIcon","ActionUserIcon","ActionUserGroupIcon","ActionVidiconIcon","ActionVolumeUpIcon","ActionXCircleIcon"]);function g(e){var t=e.provider;return e.resourceTypes.reduce((function(e,r){var n;return l({},e,((n={})[r]="application/vnd.dust."+t.replace("_","")+"."+r.replace("_","-").toLowerCase(),n))}),{})}var b="application/vnd.dust.datasource",f="application/vnd.dust.data-warehouse",v="application/vnd.dust.folder.spreadsheet",y={GENERIC:{DATA_SOURCE:b,DATA_WAREHOUSE:f},FOLDER:{SPREADSHEET:v},CONFLUENCE:g({provider:"confluence",resourceTypes:["FOLDER","PAGE","SPACE"]}),GITHUB:g({provider:"github",resourceTypes:["REPOSITORY","CODE_ROOT","CODE_DIRECTORY","CODE_FILE","ISSUES","ISSUE","DISCUSSIONS","DISCUSSION"]}),GOOGLE_DRIVE:g({provider:"google_drive",resourceTypes:["SHARED_WITH_ME","FOLDER","SPREADSHEET"]}),INTERCOM:g({provider:"intercom",resourceTypes:["COLLECTION","TEAMS_FOLDER","CONVERSATION","TEAM","ARTICLE","HELP_CENTER"]}),MICROSOFT:g({provider:"microsoft",resourceTypes:["FOLDER","SPREADSHEET"]}),NOTION:g({provider:"notion",resourceTypes:["UNKNOWN_FOLDER","SYNCING_FOLDER","DATABASE","PAGE"]}),SLACK:g({provider:"slack",resourceTypes:["CHANNEL","THREAD","MESSAGES"]}),SNOWFLAKE:g({provider:"snowflake",resourceTypes:["DATABASE","SCHEMA","TABLE"]}),WEBCRAWLER:g({provider:"webcrawler",resourceTypes:["FOLDER"]}),ZENDESK:g({provider:"zendesk",resourceTypes:["BRAND","HELP_CENTER","CATEGORY","ARTICLE","TICKETS","TICKET"]}),BIGQUERY:g({provider:"bigquery",resourceTypes:["DATABASE","SCHEMA","TABLE"]}),SALESFORCE:g({provider:"salesforce",resourceTypes:["SYNCED_QUERY_FOLDER"]}),GONG:g({provider:"gong",resourceTypes:["TRANSCRIPT","TRANSCRIPT_FOLDER"]})},x={CONFLUENCE:[y.CONFLUENCE.PAGE],GITHUB:[y.GITHUB.ISSUE,y.GITHUB.DISCUSSION],GOOGLE_DRIVE:[],INTERCOM:[y.INTERCOM.CONVERSATION,y.INTERCOM.ARTICLE],MICROSOFT:[],NOTION:[y.NOTION.PAGE],SLACK:[y.SLACK.THREAD,y.SLACK.MESSAGES],SNOWFLAKE:[],WEBCRAWLER:[],ZENDESK:[y.ZENDESK.TICKET,y.ZENDESK.ARTICLE],BIGQUERY:[],SALESFORCE:[],GONG:[]};function I(e){var t=e.category;return e.resourceTypes.reduce((function(e,r){var n;return l({},e,((n={})[r]="application/vnd.dust."+t.replace(/_/g,"-").toLowerCase()+"."+r.replace(/_/g,"-").toLowerCase(),n))}),{})}var S,E=l({},y,{TOOL_INPUT:I({category:"TOOL_INPUT",resourceTypes:["DATA_SOURCE","DATA_WAREHOUSE","TABLE","AGENT","STRING","NUMBER","BOOLEAN","ENUM","LIST","REASONING_MODEL","DUST_APP","NULLABLE_TIME_FRAME","JSON_SCHEMA"]}),TOOL_OUTPUT:I({category:"TOOL_OUTPUT",resourceTypes:["BROWSE_RESULT","DATA_SOURCE_SEARCH_QUERY","DATA_SOURCE_SEARCH_RESULT","FILESYSTEM_PATH","DATA_SOURCE_NODE_LIST","DATA_SOURCE_NODE_CONTENT","DATA_SOURCE_INCLUDE_QUERY","DATA_SOURCE_INCLUDE_RESULT","EXTRACT_QUERY","EXTRACT_RESULT","FILE","REASONING_SUCCESS","SQL_QUERY","EXECUTE_TABLES_QUERY_ERROR","THINKING","DATABASE_SCHEMA","QUERY_WRITING_INSTRUCTIONS","EXAMPLE_ROWS","TOOL_MARKER","WEBSEARCH_QUERY","WEBSEARCH_RESULT","RUN_AGENT_RESULT","RUN_AGENT_QUERY","WARNING","AGENT_CREATION_RESULT","TOOLSET_LIST_RESULT","TOOLSET_DESCRIBE_RESULT","GET_DATABASE_SCHEMA_MARKER","EXECUTE_TABLES_QUERY_MARKER"]})}),_=Object.values(y).flatMap((function(e){return Object.values(e).map((function(e){return e}))})),A=Object.values(x).flatMap((function(e){return Object.values(e).map((function(e){return e}))})),T=r.z.object({_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),R=r.z.object({method:r.z.string(),params:r.z.optional(T)}),w=r.z.object({_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough();!function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(S||(S={}));var k=r.z.object({name:r.z.string(),title:r.z.optional(r.z.string())}).passthrough(),j=r.z.object({uri:r.z.string(),mimeType:r.z.optional(r.z.string()),_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),C=j.extend({text:r.z.string()}),P=r.z.string().refine((function(e){try{return atob(e),!0}catch(e){return!1}}),{message:"Invalid Base64 string"}),O=j.extend({blob:P}),U=k.extend({uri:r.z.string(),description:r.z.optional(r.z.string()),mimeType:r.z.optional(r.z.string()),_meta:r.z.optional(r.z.object({}).passthrough())}),L=r.z.object({type:r.z.literal("text"),text:r.z.string(),_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),N=r.z.object({type:r.z.literal("image"),data:P,mimeType:r.z.string(),_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),D=r.z.object({type:r.z.literal("audio"),data:P,mimeType:r.z.string(),_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),F=r.z.object({type:r.z.literal("resource"),resource:r.z.union([C,O]),_meta:r.z.optional(r.z.object({}).passthrough())}).passthrough(),M=w.extend({content:r.z.array(r.z.union([L,N,D,U.extend({type:r.z.literal("resource_link")}),F])).default([]),structuredContent:r.z.object({}).passthrough().optional(),isError:r.z.optional(r.z.boolean())}),q=r.z.object({text:r.z.string(),uri:r.z.string(),mimeType:r.z.literal(E.TOOL_OUTPUT.FILE),fileId:r.z.string(),title:r.z.string(),contentType:r.z.string(),snippet:r.z.string().nullable()}),G=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.THINKING),text:r.z.string(),uri:r.z.literal("")}),B=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.REASONING_SUCCESS),text:r.z.string(),uri:r.z.literal("")}),H=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.SQL_QUERY),text:r.z.string(),uri:r.z.literal("")}),W=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.DATABASE_SCHEMA),text:r.z.string(),uri:r.z.string()}),V=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.QUERY_WRITING_INSTRUCTIONS),text:r.z.string(),uri:r.z.string()}),Y=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.EXAMPLE_ROWS),text:r.z.string(),uri:r.z.string()}),Q=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.DATA_SOURCE_SEARCH_QUERY),text:r.z.string(),uri:r.z.literal("")}),K=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.DATA_SOURCE_SEARCH_RESULT),uri:r.z.string(),text:r.z.string(),id:r.z.string(),tags:r.z.array(r.z.string()),ref:r.z.string(),chunks:r.z.array(r.z.string()),source:r.z.object({provider:r.z.string().optional()})}),J=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.DATA_SOURCE_INCLUDE_QUERY),text:r.z.string(),uri:r.z.literal("")}),X=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.WARNING),warningTitle:r.z.string(),text:r.z.string(),warningData:r.z.record(r.z.string(),r.z.unknown()).optional(),uri:r.z.literal("")}),Z=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.DATA_SOURCE_INCLUDE_RESULT),uri:r.z.string(),text:r.z.string(),id:r.z.string(),tags:r.z.array(r.z.string()),ref:r.z.string(),chunks:r.z.array(r.z.string()),source:r.z.object({name:r.z.string(),provider:r.z.string().optional()})}),$=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.WEBSEARCH_QUERY),text:r.z.string(),uri:r.z.literal("")}),ee=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.WEBSEARCH_RESULT),title:r.z.string(),text:r.z.string(),uri:r.z.string(),reference:r.z.string()}),te=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.BROWSE_RESULT),requestedUrl:r.z.string(),uri:r.z.string(),text:r.z.string(),title:r.z.string().optional(),description:r.z.string().optional(),responseCode:r.z.string(),errorMessage:r.z.string().optional()}),re=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.RUN_AGENT_QUERY),text:r.z.string(),childAgentId:r.z.string(),uri:r.z.literal("")}),ne=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.RUN_AGENT_RESULT),conversationId:r.z.string(),text:r.z.string(),uri:r.z.string(),refs:r.z.record(r.z.string(),r.z.object({description:r.z.string().optional(),href:r.z.string().optional(),title:r.z.string(),provider:r.z.string()})).optional()}),oe=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.TOOLSET_LIST_RESULT),text:r.z.string(),uri:r.z.literal(""),id:r.z.string(),description:r.z.string()}),se=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.EXTRACT_QUERY),text:r.z.string(),uri:r.z.literal("")}),ae=r.z.object({mimeType:r.z.literal(E.TOOL_OUTPUT.EXTRACT_RESULT),uri:r.z.string(),text:r.z.string(),fileId:r.z.string(),title:r.z.string(),contentType:r.z.string(),snippet:r.z.string().nullable()}),ie=r.z.object({type:r.z.literal("image"),mimeType:r.z.string()}),ce=r.z.object({type:r.z.literal("canvas_file"),fileId:r.z.string(),mimeType:r.z.string(),title:r.z.string(),updatedAt:r.z.string()}),ue=r.z.object({type:r.z.literal("text"),text:r.z.string()}),le=r.z.union([ie,ce,r.z.object({type:r.z.literal("run_agent"),childAgentId:r.z.string(),conversationId:r.z.string(),query:r.z.string()}),ue]).optional(),pe=r.z.object({progress:r.z.number(),total:r.z.number(),progressToken:r.z.union([r.z.string(),r.z.number()]),data:r.z.object({label:r.z.string(),output:le})}),de=R.extend({method:r.z.literal("notifications/progress"),params:pe}),ze=function(){return r.z.custom((function(e){return"string"==typeof e}))},he=ze(),me=ze(),ge=ze(),be=r.z.object({type:ze(),message:r.z.string()}),fe=r.z.number(),ve={"application/msword":[".doc",".docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".doc",".docx"],"application/vnd.ms-powerpoint":[".ppt",".pptx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".ppt",".pptx"],"application/vnd.google-apps.document":[],"application/vnd.google-apps.presentation":[],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.google-apps.spreadsheet":[],"application/vnd.ms-excel":[".xls"],"application/pdf":[".pdf"],"application/vnd.dust.section.json":[".json"],"text/comma-separated-values":[".csv"],"text/csv":[".csv"],"text/markdown":[".md",".markdown"],"text/plain":[".txt",".log",".cfg",".conf"],"text/tab-separated-values":[".tsv"],"text/tsv":[".tsv"],"text/vnd.dust.attachment.slack.thread":[".txt"],"text/html":[".html",".htm",".xhtml",".xhtml+xml"],"text/xml":[".xml"],"text/calendar":[".ics"],"text/css":[".css"],"text/javascript":[".js",".mjs",".jsx"],"text/typescript":[".ts",".tsx"],"application/json":[".json"],"application/xml":[".xml"],"application/x-sh":[".sh"],"text/x-sh":[".sh"],"text/x-python":[".py"],"text/x-python-script":[".py"],"application/x-yaml":[".yaml",".yml"],"text/yaml":[".yaml",".yml"],"text/vnd.yaml":[".yaml",".yml"],"text/x-c":[".c",".cc",".cpp",".cxx",".dic",".h",".hh"],"text/x-csharp":[".cs"],"text/x-java-source":[".java"],"text/x-php":[".php"],"text/x-ruby":[".rb"],"text/x-sql":[".sql"],"text/x-swift":[".swift"],"text/x-rust":[".rs"],"text/x-go":[".go"],"text/x-kotlin":[".kt",".kts"],"text/x-scala":[".scala"],"text/x-groovy":[".groovy"],"text/x-perl":[".pl",".pm"],"text/x-perl-script":[".pl",".pm"],"application/octet-stream":[]},ye={"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"image/webp":[".webp"]},xe=Object.keys(ve),Ie=Object.keys(ye),Se=[].concat(Object.keys(ve),Object.keys(ye)),Ee=[].concat(xe,Ie),_e=ze(),Ae=ze(),Te=ze().or(r.z.null()).or(r.z.undefined()),Re=ze(),we=function(){function e(e){this.value=void 0,this.value=e}var t=e.prototype;return t.isOk=function(){return!0},t.isErr=function(){return!1},e}(),ke=function(){function e(e){this.error=void 0,this.error=e}var t=e.prototype;return t.isOk=function(){return!1},t.isErr=function(){return!0},e}(),je=r.z.string().refine((function(e){return t.tz.names().includes(e)}),{message:"Invalid timezone"}),Ce=ze(),Pe=r.z.object({editedAt:r.z.number().nullable(),fullName:r.z.string().nullable(),imageUrl:r.z.string().nullable(),email:r.z.string().nullable(),userId:r.z.string().nullable()}),Oe=r.z.object({id:fe,sId:r.z.string(),createdAt:r.z.number(),name:r.z.string(),description:r.z.string().nullable(),assistantDefaultSelected:r.z.boolean(),dustAPIProjectId:r.z.string(),dustAPIDataSourceId:r.z.string(),connectorId:r.z.string().nullable(),connectorProvider:Ce.nullable(),editedByUser:Pe.nullable().optional()}),Ue=ze(),Le=ze(),Ne=r.z.enum(["running","succeeded","errored"]),De=r.z.record(r.z.any()),Fe=r.z.object({block_type:Le,name:r.z.string(),status:Ne,success_count:r.z.number(),error_count:r.z.number()}),Me=r.z.object({blocks:De}),qe=r.z.object({value:r.z.unknown().nullable(),error:r.z.string().nullable(),meta:r.z.unknown().nullable()}),Ge=r.z.object({run:Ne,blocks:r.z.array(Fe)}),Be=r.z.object({run_id:r.z.string(),created:r.z.number(),run_type:r.z.enum(["deploy","local","execute"]),app_hash:r.z.string().nullable().optional(),specification_hash:r.z.string().nullable().optional(),config:Me,status:Ge,traces:r.z.array(r.z.tuple([r.z.tuple([Le,r.z.string()]),r.z.array(r.z.array(qe))])),results:r.z.array(r.z.array(r.z.object({value:r.z.unknown().nullable().optional(),error:r.z.string().nullable().optional()}))).nullable().optional()}),He=ze(),We=r.z.object({type:r.z.literal("generation_tokens"),created:r.z.number(),configurationId:r.z.string(),messageId:r.z.string(),text:r.z.string(),classification:r.z.union([He,r.z.enum(["opening_delimiter","closing_delimiter"])]),delimiterClassification:He.nullable().optional()}),Ve=ze(),Ye=r.z.object({category:Ue,createdAt:r.z.number(),dataSource:Oe,editedByUser:Pe.nullable().optional(),id:fe,kind:Ve,parentsIn:r.z.array(r.z.string()).nullable(),sId:r.z.string(),updatedAt:r.z.number(),spaceId:r.z.string()}),Qe=r.z.object({chunks:r.z.array(r.z.object({offset:r.z.number(),score:r.z.number().nullable(),text:r.z.string()})),documentId:r.z.string(),dataSourceView:Ye.nullable(),id:fe,reference:r.z.string(),score:r.z.number().nullable(),sourceUrl:r.z.string().nullable(),tags:r.z.array(r.z.string()),timestamp:r.z.number()}),Ke=ze(),Je=ze().nullable(),Xe=r.z.enum(["admin","builder","user","none"]),Ze=r.z.object({id:fe,sId:r.z.string(),name:r.z.string(),role:Xe,segmentation:Je,whiteListedProviders:he.array().nullable(),defaultEmbeddingProvider:ge.nullable()}).extend({ssoEnforced:r.z.boolean().optional()}),$e=Ze.extend({blacklistedDomains:r.z.array(r.z.string()).nullable()}),et=ze().nullable(),tt=r.z.object({sId:r.z.string(),id:fe,createdAt:r.z.number(),provider:et,username:r.z.string(),email:r.z.string(),firstName:r.z.string(),lastName:r.z.string().nullable(),fullName:r.z.string(),image:r.z.string().nullable()}),rt=r.z.object({title:r.z.string(),snippet:r.z.string(),link:r.z.string(),reference:r.z.string()}),nt=r.z.object({id:fe,mcpServerId:r.z.string().nullable(),internalMCPServerName:r.z.string().nullable(),agentMessageId:fe,functionCallName:r.z.string().nullable(),status:r.z.string(),params:r.z.record(r.z.any()),output:M.shape.content.nullable()}),ot=ze(),st=r.z.union([ze(),ot]),at=ze(),it=ze(),ct=r.z.object({messageCount:r.z.number(),conversationCount:r.z.number(),userCount:r.z.number(),timePeriodSec:r.z.number()}),ut=r.z.array(r.z.string()).readonly(),lt=r.z.object({providerId:he,modelId:me,temperature:r.z.number()}),pt=r.z.object({id:fe,versionCreatedAt:r.z.string().nullable(),sId:r.z.string(),version:r.z.number(),versionAuthorId:fe.nullable(),instructions:r.z.string().nullable(),model:lt,status:st,scope:at,userFavorite:r.z.boolean(),name:r.z.string(),description:r.z.string(),pictureUrl:r.z.string(),lastAuthors:ut.optional(),usage:ct.optional(),maxStepsPerRun:r.z.number(),visualizationEnabled:r.z.boolean(),templateId:r.z.string().nullable(),groupIds:r.z.array(r.z.string()).optional(),requestedGroupIds:r.z.array(r.z.array(r.z.string()))}),dt=r.z.object({username:r.z.string().optional().nullable(),fullName:r.z.string().optional().nullable(),email:r.z.string().optional().nullable(),profilePictureUrl:r.z.string().optional().nullable()}),zt=r.z.union([r.z.literal("document"),r.z.literal("table"),r.z.literal("folder")]),ht=r.z.union([r.z.literal("table"),r.z.literal("document"),r.z.literal("all")]),mt=r.z.object({nodeId:r.z.string(),nodeDataSourceViewId:r.z.string(),nodeType:zt,provider:Ce.nullable(),spaceName:r.z.string()}),gt=r.z.object({type:r.z.literal("content_fragment"),id:fe,sId:r.z.string(),created:r.z.number(),visibility:Re,version:r.z.number(),sourceUrl:r.z.string().nullable(),title:r.z.string(),contentType:_e,context:dt,contentFragmentId:r.z.string(),contentFragmentVersion:r.z.union([r.z.literal("latest"),r.z.literal("superseded")])}),bt=r.z.union([gt.extend({contentFragmentType:r.z.literal("file"),fileId:r.z.string().nullable(),snippet:r.z.string().nullable(),generatedTables:r.z.array(r.z.string()),textUrl:r.z.string(),textBytes:r.z.number().nullable()}),gt.extend({contentFragmentType:r.z.literal("content_node"),nodeId:r.z.string(),nodeDataSourceViewId:r.z.string(),nodeType:zt,contentNodeData:mt})]),ft=r.z.object({configurationId:r.z.string()}),vt=r.z.object({username:r.z.string(),timezone:je,fullName:r.z.string().optional().nullable(),email:r.z.string().optional().nullable(),profilePictureUrl:r.z.string().optional().nullable(),origin:Te,clientSideMCPServerIds:r.z.array(r.z.string()).optional().nullable(),selectedMCPServerViewIds:r.z.array(r.z.string()).optional().nullable()}),yt=r.z.object({id:fe,created:r.z.number(),type:r.z.literal("user_message"),sId:r.z.string(),visibility:Re,version:r.z.number(),user:tt.nullable(),mentions:r.z.array(ft),content:r.z.string(),context:vt}),xt=ze(),It=r.z.object({id:fe,agentMessageId:fe,created:r.z.number(),type:r.z.literal("agent_message"),sId:r.z.string(),visibility:Re,version:r.z.number(),parentMessageId:r.z.string().nullable(),configuration:pt,status:xt,actions:r.z.array(nt),content:r.z.string().nullable(),chainOfThought:r.z.string().nullable(),rawContents:r.z.array(r.z.object({step:r.z.number(),content:r.z.string()})),error:r.z.object({code:r.z.string(),message:r.z.string(),metadata:r.z.record(r.z.any()).nullable()}).nullable()}),St=r.z.object({messageId:r.z.string(),agentMessageId:r.z.number(),userId:r.z.number(),thumbDirection:r.z.union([r.z.literal("up"),r.z.literal("down")]),content:r.z.string().nullable(),createdAt:r.z.number(),agentConfigurationId:r.z.string(),agentConfigurationVersion:r.z.number(),isConversationShared:r.z.boolean()}),Et=ze(),_t=r.z.object({id:fe,created:r.z.number(),updated:r.z.number().optional(),owner:Ze,sId:r.z.string(),title:r.z.string().nullable(),visibility:Et,groupIds:r.z.array(r.z.string()).optional(),requestedGroupIds:r.z.array(r.z.array(r.z.string()))}),At=_t.extend({content:r.z.array(r.z.union([r.z.array(yt),r.z.array(It),r.z.array(bt)]))}),Tt=r.z.enum(["low","high","never_ask"]).optional(),Rt=r.z.object({mcpServerName:r.z.string(),toolName:r.z.string(),agentName:r.z.string(),pubsubMessageId:r.z.string().optional(),icon:r.z.union([h,m]).optional()}),wt=r.z.enum(["blocked_authentication_required","blocked_validation_required","blocked_child_action_input_required"]),kt=r.z.object({actionId:r.z.string(),inputs:r.z.record(r.z.any()),stake:Tt,metadata:Rt}).extend({messageId:r.z.string(),conversationId:r.z.string(),status:wt}),jt=r.z.object({message:r.z.string(),code:r.z.string()}),Ct=r.z.tuple([r.z.number(),r.z.string()]),Pt=r.z.object({type:ze(),message:r.z.string(),data_source_error:jt.optional(),run_error:jt.optional(),app_error:jt.optional(),connectors_error:be.optional()}),Ot=r.z.object({domain:r.z.string(),domainAutoJoinEnabled:r.z.boolean()}),Ut=r.z.object({appHash:r.z.string(),appId:r.z.string(),workspaceId:r.z.string()}),Lt=r.z.record(r.z.unknown()),Nt=r.z.object({type:r.z.literal("error"),content:r.z.object({code:r.z.string(),message:r.z.string()})}),Dt=r.z.object({type:r.z.literal("run_status"),content:r.z.object({status:r.z.enum(["running","succeeded","errored"]),run_id:r.z.string()})}),Ft=r.z.object({type:r.z.literal("block_status"),content:r.z.object({block_type:Le,name:r.z.string(),status:Ne,success_count:r.z.number(),error_count:r.z.number()})}),Mt=r.z.object({type:r.z.literal("block_execution"),content:r.z.object({block_type:Le,block_name:r.z.string(),execution:r.z.array(r.z.array(r.z.object({value:r.z.unknown().nullable(),error:r.z.string().nullable(),meta:r.z.unknown().nullable()})))})}),qt=r.z.object({type:r.z.literal("final")}),Gt=r.z.object({type:r.z.literal("tokens"),content:r.z.object({block_type:r.z.string(),block_name:r.z.string(),input_index:r.z.number(),map:r.z.object({name:r.z.string(),iteration:r.z.number()}).nullable(),tokens:r.z.object({text:r.z.string(),tokens:r.z.array(r.z.string()).optional(),logprobs:r.z.array(r.z.number()).optional()})})}),Bt=r.z.object({type:r.z.literal("reasoning_tokens"),content:r.z.object({block_type:r.z.string(),block_name:r.z.string(),input_index:r.z.number(),map:r.z.object({name:r.z.string(),iteration:r.z.number()}).nullable(),tokens:r.z.object({text:r.z.string()})})}),Ht=r.z.object({type:r.z.literal("reasoning_item"),content:r.z.object({block_type:r.z.string(),block_name:r.z.string(),input_index:r.z.number(),map:r.z.object({name:r.z.string(),iteration:r.z.number()}).nullable(),item:r.z.unknown()})}),Wt=r.z.object({type:r.z.literal("function_call"),content:r.z.object({block_type:r.z.string(),block_name:r.z.string(),input_index:r.z.number(),map:r.z.object({name:r.z.string(),iteration:r.z.number()}).nullable(),function_call:r.z.object({name:r.z.string()})})}),Vt=r.z.object({type:r.z.literal("function_call_arguments_tokens"),content:r.z.object({block_type:r.z.string(),block_name:r.z.string(),input_index:r.z.number(),map:r.z.object({name:r.z.string(),iteration:r.z.number()}).nullable(),tokens:r.z.object({text:r.z.string()})})}),Yt=ze(),Qt=r.z.object({createdAt:r.z.number(),groupIds:r.z.array(r.z.string()),isRestricted:r.z.boolean(),kind:Yt,name:r.z.string(),sId:r.z.string(),updatedAt:r.z.number()}),Kt=ze(),Jt=r.z.object({name:r.z.string(),description:r.z.string().nullable(),data:r.z.array(r.z.record(r.z.any())).nullable().optional(),schema:r.z.array(r.z.object({key:r.z.string(),type:Kt,description:r.z.string().nullable()})).nullable().optional()}),Xt=r.z.object({id:fe,sId:r.z.string(),name:r.z.string(),description:r.z.string().nullable(),savedSpecification:r.z.string().nullable(),savedConfig:r.z.string().nullable(),savedRun:r.z.string().nullable(),dustAPIProjectId:r.z.string(),space:Qt,datasets:r.z.array(Jt).optional(),coreSpecifications:r.z.record(r.z.string()).optional()}),Zt=r.z.object({id:fe.optional(),sId:r.z.string(),name:r.z.string(),description:r.z.string().nullable(),savedSpecification:r.z.string().nullable(),savedConfig:r.z.string().nullable(),savedRun:r.z.string().nullable(),dustAPIProjectId:r.z.string(),datasets:r.z.array(Jt).optional(),coreSpecifications:r.z.record(r.z.string()).optional()}),$t=r.z.object({run:Be}),er=r.z.object({data_sources:Oe.array()}),tr=r.z.object({agentConfiguration:pt}),rr=r.z.object({userFavorite:r.z.boolean().optional()}),nr=r.z.object({agentConfigurations:pt.array()}),or=r.z.object({name:r.z.string(),description:r.z.string(),instructions:r.z.string(),emoji:r.z.string().optional(),subAgentName:r.z.string().optional(),subAgentDescription:r.z.string().optional(),subAgentInstructions:r.z.string().optional(),subAgentEmoji:r.z.string().optional()}),sr=r.z.object({agentConfiguration:pt,subAgentConfiguration:pt.optional()}),ar=r.z.object({contentFragment:bt}),ir=r.z.object({conversation:At,message:yt.optional()}),cr=r.z.object({feedbacks:r.z.array(St)}),ur=r.z.object({thumbDirection:r.z.string(),feedbackContent:r.z.string().nullable().optional(),isConversationShared:r.z.boolean().optional()}),lr=r.z.object({success:r.z.literal(!0)}),pr=r.z.object({message:yt}),dr=r.z.object({message:It}),zr=r.z.object({conversation:At}),hr=r.z.object({tokens:Ct.array()}),mr=r.z.object({emails:r.z.array(r.z.string())}),gr=r.z.object({verified_domains:Ot.array()}),br=r.z.object({feature_flags:Ke.array()}),fr=r.z.intersection(r.z.object({content:r.z.string().min(1),mentions:r.z.array(r.z.object({configurationId:r.z.string()})),context:vt.extend({clientSideMCPServerIds:r.z.array(r.z.string()).optional().nullable()})}),r.z.object({blocking:r.z.boolean().optional(),skipToolsValidation:r.z.boolean().optional()}).partial()),vr=r.z.object({content:r.z.string(),mentions:r.z.array(r.z.object({configurationId:r.z.string()})),skipToolsValidation:r.z.boolean().optional().default(!1)}),yr=r.z.object({title:r.z.string(),url:r.z.string().optional().nullable(),content:r.z.string(),contentType:r.z.string(),fileId:r.z.undefined().nullable(),nodeId:r.z.undefined().nullable(),nodeDataSourceViewId:r.z.undefined().nullable(),context:dt.optional().nullable(),supersededContentFragmentId:r.z.string().optional().nullable()}),xr=r.z.object({title:r.z.string(),fileId:r.z.string(),url:r.z.string().optional().nullable(),content:r.z.undefined().nullable(),contentType:r.z.undefined().nullable(),nodeId:r.z.undefined().nullable(),nodeDataSourceViewId:r.z.undefined().nullable(),context:dt.optional().nullable(),supersededContentFragmentId:r.z.string().optional().nullable()}),Ir=r.z.object({title:r.z.string(),nodeId:r.z.string(),nodeDataSourceViewId:r.z.string(),url:r.z.undefined().nullable(),content:r.z.undefined().nullable(),contentType:r.z.undefined().nullable(),fileId:r.z.undefined().nullable(),context:dt.optional().nullable(),supersededContentFragmentId:r.z.string().optional().nullable()}),Sr=r.z.union([yr,xr,Ir]),Er=r.z.intersection(r.z.object({title:r.z.string().nullable().optional(),visibility:r.z.enum(["workspace","unlisted","deleted","test"]).optional().default("unlisted"),depth:r.z.number().optional(),message:r.z.union([r.z.intersection(r.z.object({content:r.z.string().min(1),mentions:r.z.array(r.z.object({configurationId:r.z.string()})),context:vt}),r.z.object({blocking:r.z.boolean().optional()}).partial()),r.z.undefined()]),contentFragment:r.z.union([yr,xr,Ir,r.z.undefined()]),contentFragments:r.z.union([r.z.union([yr,xr,Ir]).array(),r.z.undefined()])}),r.z.object({blocking:r.z.boolean().optional(),skipToolsValidation:r.z.boolean().optional()}).partial()),_r=r.z.object({conversation:At,message:yt.optional(),contentFragment:bt.optional()}),Ar=r.z.object({conversations:_t.array()}),Tr=r.z.object({dataSourceId:r.z.string().optional(),kind:r.z.string().optional(),vaultId:r.z.string().optional(),vaultKind:r.z.string().optional()}),Rr=r.z.object({data_source_views:Ye.array()}),wr=r.z.object({email:r.z.string()}),kr=r.z.object({apps:Xt.array()}),jr=r.z.object({apps:Zt.array()}),Cr=r.z.object({apps:r.z.object({sId:r.z.string(),name:r.z.string(),error:r.z.string().optional()}).array()}),Pr=r.z.object({dataSourceView:Ye}),Or=r.z.union([r.z.object({parentsToAdd:r.z.union([r.z.array(r.z.string()),r.z.undefined()]),parentsToRemove:r.z.array(r.z.string()).optional()}).transform((function(e){return{parentsToAdd:e.parentsToAdd,parentsToRemove:e.parentsToRemove}})),r.z.object({parentsIn:r.z.array(r.z.string())})]),Ur=r.z.object({query:r.z.string(),top_k:r.z.coerce.number(),full_text:r.z.coerce.boolean(),target_document_tokens:r.z.coerce.number().optional(),timestamp_gt:r.z.coerce.number().optional(),timestamp_lt:r.z.coerce.number().optional(),tags_in:r.z.array(r.z.string()).optional(),tags_not:r.z.array(r.z.string()).optional(),parents_in:r.z.array(r.z.string()).optional(),parents_not:r.z.array(r.z.string()).optional()}),Lr=r.z.lazy((function(){return r.z.object({prefix:r.z.string().nullable(),content:r.z.string().nullable(),sections:r.z.array(Lr)})})),Nr=r.z.object({timestamp:r.z.number().nullable().optional(),tags:r.z.array(r.z.string()).nullable().optional(),parent_id:r.z.string().nullable().optional(),parents:r.z.array(r.z.string()).nullable().optional(),source_url:r.z.string().nullable().optional(),upsert_context:r.z.object({sync_type:r.z.union([r.z.enum(["batch","incremental"]),r.z.undefined()])}).transform((function(e){return{sync_type:e.sync_type}})).optional(),text:r.z.string().nullable().optional(),section:Lr.nullable().optional(),light_document_output:r.z.boolean().optional(),async:r.z.boolean().nullable().optional(),mime_type:r.z.string().nullable().optional(),title:r.z.string().nullable().optional()}),Dr=r.z.object({rows:r.z.array(r.z.object({row_id:r.z.string(),value:r.z.record(r.z.union([r.z.string(),r.z.number(),r.z.boolean(),r.z.object({type:r.z.literal("datetime"),epoch:r.z.number()})]).nullable())})),truncate:r.z.boolean().optional()}),Fr=r.z.object({parent_id:r.z.string().nullable().optional(),parents:r.z.array(r.z.string())}),Mr=r.z.object({name:r.z.string(),description:r.z.string(),timestamp:r.z.number().nullable().optional(),tags:r.z.array(r.z.string()).nullable().optional(),parentId:r.z.string().nullable().optional(),parents:r.z.array(r.z.string()).nullable().optional(),truncate:r.z.boolean(),async:r.z.boolean().optional(),title:r.z.string(),mimeType:r.z.string(),sourceUrl:r.z.string().nullable().optional(),tableId:r.z.string(),fileId:r.z.string(),allowEmptySchema:r.z.boolean().optional()}),qr=r.z.object({table_id:r.z.string().optional(),name:r.z.string(),description:r.z.string(),timestamp:r.z.number().nullable().optional(),tags:r.z.array(r.z.string()).nullable().optional(),parent_id:r.z.string().nullable().optional(),parents:r.z.array(r.z.string()).nullable().optional(),remote_database_table_id:r.z.string().nullable().optional(),remote_database_secret_id:r.z.string().nullable().optional(),title:r.z.string(),mime_type:r.z.string().nullable().optional(),source_url:r.z.string().nullable().optional()}),Gr=ze(),Br=r.z.object({data_source_id:r.z.string(),folder_id:r.z.string(),title:r.z.string(),parents:r.z.array(r.z.string()),timestamp:r.z.number()}),Hr=r.z.object({folders:r.z.array(Br),total:r.z.number()}),Wr=r.z.object({folder:Br}),Vr=r.z.object({folder:r.z.object({folder_id:r.z.string()})}),Yr=r.z.object({folder:Br,data_source:Oe}),Qr=ze(),Kr=r.z.object({timestamp:r.z.number(),parents:r.z.array(r.z.string()).nullable().optional(),parent_id:r.z.string().nullable().optional(),title:r.z.string(),mime_type:r.z.string(),source_url:r.z.string().nullable().optional(),provider_visibility:Qr.nullable().optional()}),Jr=r.z.string().refine((function(e){return/^\d{4}-(0[1-9]|1[0-2])(-([0-2]\d|3[01]))?$/.test(e)}),"YYYY-MM or YYYY-MM-DD"),Xr=r.z.union([r.z.object({start:Jr,end:r.z.undefined(),mode:r.z.literal("month"),table:Gr,format:r.z.enum(["csv","json"]).optional().default("csv")}),r.z.object({start:Jr,end:Jr,mode:r.z.literal("range"),table:Gr,format:r.z.enum(["csv","json"]).optional().default("csv")})]),Zr=r.z.object({contentType:Ae,fileName:r.z.string().max(4096,"File name must be less than 4096 characters"),fileSize:r.z.number(),useCase:r.z.union([r.z.literal("conversation"),r.z.literal("upsert_table")]),useCaseMetadata:r.z.object({conversationId:r.z.string()}).optional()}),$r=ze(),en=ze(),tn=r.z.object({id:r.z.string(),sId:r.z.string(),contentType:r.z.string(),downloadUrl:r.z.string().optional(),fileName:r.z.string(),fileSize:r.z.number(),status:$r,uploadUrl:r.z.string().optional(),publicUrl:r.z.string().optional(),useCase:en}),rn=tn.extend({uploadUrl:r.z.string()}),nn=r.z.object({file:rn}),on=r.z.object({file:tn}),sn=r.z.object({user:tt.and(r.z.object({workspaces:Ze.array().or($e.array())}))}),an=r.z.object({success:r.z.literal(!0)}),cn=r.z.object({messageIds:r.z.array(r.z.string())});function un(e){return e.dataSourceView?"webcrawler"===e.dataSourceView.dataSource.connectorProvider?"document":e.dataSourceView.dataSource.connectorProvider||"document":"document"}var ln=r.z.object({apps:r.z.array(r.z.object({appId:r.z.string(),appHash:r.z.string()}))}),pn=r.z.object({apps:r.z.array(r.z.object({appId:r.z.string(),appHash:r.z.string(),deployed:r.z.boolean()}))}),dn=r.z.object({spaces:r.z.array(Qt)}),zn=ze(),hn=ze(),mn=ze(),gn=r.z.object({sId:r.z.string(),name:r.z.string(),version:r.z.string(),description:r.z.string(),icon:r.z.union([hn,mn]),authorization:r.z.object({provider:zn,supported_use_cases:r.z.array(r.z.enum(["personal_actions","platform_actions"])),scope:r.z.string().optional()}).nullable(),tools:r.z.array(r.z.object({name:r.z.string(),description:r.z.string(),inputSchema:r.z.any().optional()})),availability:r.z.enum(["manual","auto","auto_hidden_builder"]),allowMultipleInstances:r.z.boolean(),documentationUrl:r.z.string().nullable()}),bn=r.z.object({id:r.z.number(),sId:r.z.string(),name:r.z.string().nullable(),description:r.z.string().nullable(),createdAt:r.z.number(),updatedAt:r.z.number(),spaceId:r.z.string(),serverType:r.z.enum(["remote","internal"]),server:gn,oAuthUseCase:r.z.enum(["personal_actions","platform_actions"]).nullable(),editedByUser:Pe.nullable()}),fn=r.z.object({success:r.z.literal(!0),serverViews:r.z.array(bn)}),vn=r.z.object({includeAuto:r.z.enum(["true","false"]).transform((function(e){return"true"===e})).optional()}),yn=r.z.object({viewType:ht,spaceIds:r.z.array(r.z.string()),includeDataSources:r.z.boolean(),limit:r.z.number()}),xn=r.z.union([r.z.intersection(yn,r.z.object({query:r.z.string(),nodeIds:r.z.undefined().optional(),searchSourceUrls:r.z.boolean().optional()})),r.z.intersection(yn,r.z.object({nodeIds:r.z.array(r.z.string()),query:r.z.undefined().optional()}))]),In=r.z.object({expandable:r.z.boolean(),internalId:r.z.string(),lastUpdatedAt:r.z.number().nullable(),mimeType:r.z.string(),parentInternalId:r.z.string().nullable(),preventSelection:r.z.boolean().optional(),providerVisibility:Qr.nullable().optional(),sourceUrl:r.z.string().nullable().optional(),title:r.z.string(),type:zt}),Sn=r.z.intersection(In,r.z.object({parentsInternalIds:r.z.array(r.z.string()).optional(),parentTitle:r.z.string().optional().nullable()})),En=r.z.intersection(Sn,r.z.object({dataSource:Oe,dataSourceViews:Ye.array()})),_n=r.z.intersection(Sn,r.z.object({dataSourceView:Ye})),An=r.z.literal("truncated-query-clauses"),Tn=r.z.object({nodes:En.array(),warningCode:An.optional().nullable()}),Rn=r.z.object({success:r.z.boolean()}),wn=r.z.enum(["approved","rejected","always_approved"]),kn=r.z.object({actionId:r.z.string(),approved:wn}),jn=r.z.string().min(5).max(30),Cn=r.z.object({serverName:jn}),Pn=r.z.object({serverId:r.z.string()}),On=r.z.object({expiresAt:r.z.string(),serverId:r.z.string()}),Un=r.z.object({success:r.z.boolean(),expiresAt:r.z.string()}),Ln=r.z.object({result:r.z.unknown(),serverId:r.z.string()}),Nn=r.z.object({serverId:r.z.string(),lastEventId:r.z.string().optional()}),Dn=r.z.object({success:r.z.boolean()}),Fn=r.z.object({blockedActions:r.z.array(kt)}),Mn=r.z.enum(["manual","auto"]),qn=r.z.object({spaceIds:r.z.array(r.z.string()),availabilities:r.z.array(Mn)}),Gn=r.z.object({userIds:r.z.array(r.z.string())}),Bn=console,Hn=function(){function e(e,t,r,n,o){void 0===r&&(r="Dust Extension"),void 0===n&&(n=!1),void 0===o&&(o=45e3),this.dustAPI=void 0,this.onServerIdReceived=void 0,this.serverName=void 0,this.verbose=void 0,this.eventSourceHeartbeat=void 0,this.eventSource=null,this.lastEventId=null,this.heartbeatTimer=null,this.serverId=null,this.onmessage=void 0,this.onclose=void 0,this.onerror=void 0,this.sessionId=void 0,this.dustAPI=e,this.onServerIdReceived=t,this.serverName=r,this.verbose=n,this.eventSourceHeartbeat=o}var t=e.prototype;return t.registerServer=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dustAPI.registerMCPServer({serverName:this.serverName});case 2:if(!(t=e.sent).isErr()){e.next=6;break}return this.logError("Failed to register MCP server: "+t.error),e.abrupt("return",!1);case 6:return this.serverId=r=t.value.serverId,this.onServerIdReceived(r),this.setupHeartbeat(r),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.setupHeartbeat=function(e){var t=this;this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(i(p().mark((function r(){var n,o;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.dustAPI.heartbeatMCPServer({serverId:e});case 2:if(!(n=r.sent).isErr()&&!1!==n.value.success){r.next=8;break}return o=n.isErr()?n.error:new Error("Server not registered"),t.logError("Failed to heartbeat MCP server: "+o),r.next=8,t.registerServer();case 8:case"end":return r.stop()}}),r)}))),9e5)},t.start=function(){var e=i(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.registerServer();case 3:if(e.sent){e.next=6;break}throw new Error("Failed to register MCP server");case 6:return e.next=8,this.connectToRequestsStream();case 8:this.logInfo("MCP transport started successfully"),e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),this.logError("Failed to start MCP transport:",e.t0),null==(t=this.onerror)||t.call(this,e.t0 instanceof Error?e.t0:new Error(String(e.t0))),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),t.connectToRequestsStream=function(){var e=i(p().mark((function e(){var t,r,o=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.serverId){e.next=3;break}return this.logError("Server ID is not set"),e.abrupt("return");case 3:return this.eventSource&&(this.eventSource.close(),this.eventSource=null),e.next=6,this.dustAPI.getMCPRequestsConnectionDetails({serverId:this.serverId,lastEventId:this.lastEventId});case 6:if(!(t=e.sent).isErr()){e.next=9;break}throw new Error("Failed to get connection details: "+t.error.message);case 9:this.eventSource=new n.EventSourcePolyfill((r=t.value).url,{headers:r.headers,heartbeatTimeout:this.eventSourceHeartbeat}),this.eventSource.onmessage=function(e){try{if("done"===e.data)return;var t=JSON.parse(e.data);t.eventId&&(o.lastEventId=t.eventId);var r=t.data;if(!r)return void o.logError("No data field found in the event");o.onmessage?o.onmessage(r):o.logError("ERROR: onmessage handler not set - MCP response won't be sent")}catch(e){o.logError("Failed to parse MCP request:",e),null==o.onerror||o.onerror(new Error("Failed to parse MCP request: "+e))}},this.eventSource.onerror=function(e){o.logError("Error in MCP EventSource connection:",e),null==o.onerror||o.onerror(new Error("SSE connection error: "+e)),setTimeout((function(){o.eventSource&&(o.logInfo("Attempting to reconnect to SSE..."),o.connectToRequestsStream().catch((function(e){o.logError("Failed to reconnect:",e)})))}),5e3)},this.eventSource.onopen=function(){o.logInfo("MCP SSE connection established")},this.eventSource.addEventListener("close",(function(){o.logInfo("MCP SSE connection closed"),null==o.onclose||o.onclose()}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.send=function(){var e=i(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.serverId){e.next=3;break}return this.logError("Server ID is not set"),e.abrupt("return");case 3:return e.next=5,this.dustAPI.postMCPResults({serverId:this.serverId,result:t});case 5:(r=e.sent).isErr()&&(this.logError("Failed to send MCP result:",r.error),null==(n=this.onerror)||n.call(this,new Error("Failed to send MCP result: "+r.error)));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.close=function(){var e=i(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.eventSource&&(this.logInfo("Closing MCP SSE connection"),this.eventSource.close(),this.eventSource=null),null==(t=this.onclose)||t.call(this);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.logError=function(){this.verbose&&Bn.error.apply(Bn,arguments)},t.logInfo=function(){this.verbose&&Bn.log.apply(Bn,arguments)},t.getServerId=function(){var e;return null!=(e=this.serverId)?e:void 0},e}(),Wn=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t.body){e.next=2;break}return e.abrupt("return",t.body);case 2:r=t.body.getReader(),n=new TextDecoder,o="",e.prev=5,s=!1;case 7:if(s){e.next=17;break}return e.next=10,r.read();case 10:s=(a=e.sent).done,(i=a.value)&&(o+=n.decode(i,{stream:!0})),e.next=7;break;case 17:o+=n.decode();case 18:return e.prev=18,r.releaseLock(),e.finish(18);case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}}),e,null,[[5,,18,21]])})));return function(t){return e.apply(this,arguments)}}(),Vn=function(){function t(e,t,r,n){this._url=void 0,this._credentials=void 0,this._logger=void 0,this._urlOverride=void 0,this._url=e.url,this._credentials=t,this._logger=r,this._urlOverride=n}var r=t.prototype;return r.workspaceId=function(){return this._credentials.workspaceId},r.setWorkspaceId=function(e){this._credentials.workspaceId=e},r.apiUrl=function(){return this._urlOverride?this._urlOverride:this._url},r.getApiKey=function(){var e=i(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof this._credentials.apiKey){e.next=2;break}return e.abrupt("return",this._credentials.apiKey());case 2:return e.abrupt("return",this._credentials.apiKey);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.baseHeaders=function(){var e=i(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getApiKey();case 2:return e.t0=e.sent,e.t1="Bearer "+e.t0,t={Authorization:e.t1},this._credentials.extraHeaders&&Object.assign(t,this._credentials.extraHeaders),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.me=function(){var e=i(p().mark((function e(){var t,r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getApiKey();case 2:return e.t0=e.sent,e.t1="Bearer "+e.t0,t={"Content-Type":"application/json",Authorization:e.t1},e.next=7,this._fetchWithError(this.apiUrl()+"/api/v1/me",{method:"GET",headers:t});case 7:return r=e.sent,e.next=10,this._resultFromResponse(sn,r);case 10:if(!(n=e.sent).isErr()){e.next=13;break}return e.abrupt("return",n);case 13:return e.abrupt("return",new we(n.value.user));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.request=function(){var e=i(p().mark((function e(t){var r,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.path=t.path.replace(/^\/+/,""),n=this.apiUrl()+"/api/v1/w/"+(null!=(r=t.overrideWorkspaceId)?r:this.workspaceId())+"/"+t.path,t.query&&(n+="?"+t.query.toString()),e.t0=l,e.t1={},e.next=7,this.baseHeaders();case 7:return e.t2=e.sent,e.t3=t.headers,(o=(0,e.t0)(e.t1,e.t2,e.t3))["Content-Type"]="application/json",t.stream&&(o.Accept="text/event-stream"),e.next=14,this._fetchWithError(n,{method:t.method,headers:o,body:t.body?JSON.stringify(t.body):void 0,signal:t.signal,stream:t.stream});case 14:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.runApp=function(){var e=i(p().mark((function e(t,r,n,o){var s,a,i,c,u,l,d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.workspaceId,a=t.appId,i=t.appHash,c=t.appSpaceId,u=(void 0===o?{useWorkspaceCredentials:!1}:o).useWorkspaceCredentials,e.next=4,this.request({overrideWorkspaceId:s,path:"spaces/"+c+"/apps/"+a+"/runs",query:new URLSearchParams({use_workspace_credentials:u?"true":"false"}),method:"POST",body:{specification_hash:i,config:r,stream:!1,blocking:!0,inputs:n}});case 4:return l=e.sent,e.next=7,this._resultFromResponse($t,l);case 7:if(!(d=e.sent).isErr()){e.next=10;break}return e.abrupt("return",d);case 10:return e.abrupt("return",new we(d.value.run));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),r.runAppStreamed=function(){var t=i(p().mark((function t(r,n,o,s){var a,u,l,z,h,m,g,b;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b=function(){return b=i(p().mark((function t(r,n){var o,s,a,i,u,l,z;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.ok&&r.body){t.next=5;break}return t.next=3,Wn(r);case 3:return t.abrupt("return",new ke({type:"dust_api_error",message:"Error running streamed app: status_code="+r.status+" body="+t.sent}));case 5:return o=!1,i=new Promise((function(e,t){s=t,a=e})),u=[],l=e.createParser((function(e){if("event"===e.type&&e.data)try{var t,r=JSON.parse(e.data);switch(r.type){case"error":u.push({type:"error",content:{code:r.content.code,message:r.content.message}});break;case"run_status":case"block_status":case"block_execution":u.push({type:r.type,content:r.content});break;case"tokens":u.push({type:"tokens",content:r.content});break;case"reasoning_tokens":u.push({type:"reasoning_tokens",content:r.content});break;case"reasoning_item":u.push({type:"reasoning_item",content:r.content});break;case"function_call":u.push({type:"function_call",content:r.content});break;case"function_call_arguments_tokens":u.push({type:"function_call_arguments_tokens",content:r.content});break;case"final":u.push({type:"final"})}null!=(t=r.content)&&t.run_id&&!o&&(o=!0,a(r.content.run_id))}catch(e){n.error({error:e},"Failed parsing chunk from Dust API")}})),z=function(){var e=d(p().mark((function e(){var t,a,i,d,z,h,m,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body&&"string"!=typeof r.body){e.next=2;break}throw new Error("Expected a stream response, but got a string or null");case 2:t=r.body.getReader(),a=new TextDecoder,e.prev=4;case 5:return e.next=7,c(t.read());case 7:if(z=(i=e.sent).done,!(d=i.value)){e.next=21;break}l.feed(a.decode(d,{stream:!0})),h=0,m=u;case 13:if(!(h<m.length)){e.next=20;break}return g=m[h],e.next=17,g;case 17:h++,e.next=13;break;case 20:u=[];case 21:if(!z){e.next=23;break}return e.abrupt("break",25);case 23:e.next=5;break;case 25:o||setImmediate((function(){n.error({},"No run id received."),s(new Error("No run id received"))})),e.next=33;break;case 28:return e.prev=28,e.t0=e.catch(4),n.error({error:e.t0,errorStr:JSON.stringify(e.t0),errorSource:"processStreamedRunResponse"},"DustAPI error: streaming chunks"),e.next=33,{type:"error",content:{code:"stream_error",message:"Error streaming chunks"}};case 33:case"end":return e.stop()}}),e,null,[[4,28]])})));return function(){return e.apply(this,arguments)}}(),t.abrupt("return",new we({eventStream:z(),dustRunId:i}));case 11:case"end":return t.stop()}}),t)}))),b.apply(this,arguments)},g=function(e,t){return b.apply(this,arguments)},a=r.workspaceId,u=r.appId,l=r.appHash,z=r.appSpaceId,h=(void 0===s?{useWorkspaceCredentials:!1}:s).useWorkspaceCredentials,t.next=6,this.request({overrideWorkspaceId:a,path:"spaces/"+z+"/apps/"+u+"/runs",query:new URLSearchParams({use_workspace_credentials:h?"true":"false"}),method:"POST",body:{specification_hash:l,config:n,stream:!0,blocking:!1,inputs:o},stream:!0});case 6:if(!(m=t.sent).isErr()){t.next=9;break}return t.abrupt("return",m);case 9:return t.abrupt("return",g(m.value.response,this._logger));case 10:case"end":return t.stop()}}),t,this)})));return function(e,r,n,o){return t.apply(this,arguments)}}(),r.getDataSources=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"data_sources"});case 2:return t=e.sent,e.next=5,this._resultFromResponse(er,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.data_sources));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getAgentConfigurations=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){var e=new URLSearchParams;return"string"==typeof r&&e.append("view",r),o.includes("authors")&&e.append("withAuthors","true"),e.toString()},o=void 0===(n=t.includes)?[]:n,a=(r=t.view)||o.length>0?s():null,i=a?"assistant/agent_configurations?"+a:"assistant/agent_configurations",e.next=6,this.request({path:i,method:"GET"});case 6:return c=e.sent,e.next=9,this._resultFromResponse(nr,c);case 9:if(!(u=e.sent).isErr()){e.next=12;break}return e.abrupt("return",u);case 12:return e.abrupt("return",new we(u.value.agentConfigurations));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.postContentFragment=function(){var e=i(p().mark((function e(t){var r,n,o,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,n=t.contentFragment,e.next=3,this.request({method:"POST",path:"assistant/conversations/"+r+"/content_fragments",body:l({},n)});case 3:return o=e.sent,e.next=6,this._resultFromResponse(ar,o);case 6:if(!(s=e.sent).isErr()){e.next=9;break}return e.abrupt("return",s);case 9:return e.abrupt("return",new we(s.value.contentFragment));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.createGenericAgentConfiguration=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u,l,d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.description,o=t.instructions,s=t.emoji,a=t.subAgentName,i=t.subAgentDescription,c=t.subAgentInstructions,u=t.subAgentEmoji,e.next=3,this.request({method:"POST",path:"assistant/generic_agents",body:{name:r,description:n,instructions:o,emoji:s,subAgentName:a,subAgentDescription:i,subAgentInstructions:c,subAgentEmoji:u}});case 3:return l=e.sent,e.next=6,this._resultFromResponse(sr,l);case 6:if(!(d=e.sent).isErr()){e.next=9;break}return e.abrupt("return",d);case 9:return e.abrupt("return",new we(d.value));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.createConversation=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u,l,d,z;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.title,n=t.visibility,o=t.depth,s=t.message,a=t.contentFragment,i=t.contentFragments,u=void 0!==(c=t.blocking)&&c,d=void 0!==(l=t.skipToolsValidation)&&l,z=new URLSearchParams(t.params),e.next=4,this.request({method:"POST",path:"assistant/conversations",query:z.toString()?z:void 0,body:{title:r,visibility:n,depth:o,message:s,contentFragment:a,contentFragments:i,blocking:u,skipToolsValidation:d}});case 4:return e.abrupt("return",this._resultFromResponse(ir,e.sent));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.postUserMessage=function(){var e=i(p().mark((function e(t){var r,n,o,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,n=t.message,e.next=3,this.request({method:"POST",path:"assistant/conversations/"+r+"/messages",body:l({},n)});case 3:return o=e.sent,e.next=6,this._resultFromResponse(pr,o);case 6:if(!(s=e.sent).isErr()){e.next=9;break}return e.abrupt("return",s);case 9:return e.abrupt("return",new we(s.value.message));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.streamAgentAnswerEvents=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.userMessageId,i=t.signal,u=void 0===(c=t.options)?{maxReconnectAttempts:10,reconnectDelay:5e3,autoReconnect:!0}:c,0!==(l=(s=t.conversation).content.map((function(e){return e[e.length-1]})).filter((function(e){return e&&"agent_message"===e.type&&e.parentMessageId===a}))).length){e.next=4;break}return e.abrupt("return",new ke(new Error("Failed to retrieve agent message")));case 4:return e.abrupt("return",this.streamAgentMessageEvents({conversation:s,agentMessage:l[0],signal:i,options:{maxReconnectAttempts:null!=(r=u.maxReconnectAttempts)?r:10,reconnectDelay:null!=(n=u.reconnectDelay)?n:5e3,autoReconnect:null==(o=u.autoReconnect)||o}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.streamAgentMessageEvents=function(){var t=i(p().mark((function t(r){var n,o,s,a,l,z,h,m,g,b,f,v,y,x,I=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.conversation,o=r.agentMessage,s=r.signal,l=(a=r.options).maxReconnectAttempts,z=a.reconnectDelay,h=a.autoReconnect,m=null,g=["agent_message_success","agent_error","agent_generation_cancelled","user_message_error"],b=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="assistant/conversations/"+n.sId+"/messages/"+o.sId+"/events",t&&(r+="?lastEventId="+t),e.abrupt("return",I.request({method:"GET",path:r,signal:s,stream:!0}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=this._logger,v=0,y=!1,x=function(){var t=d(p().mark((function t(){var r,n;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=p().mark((function t(){var r,n,o,a,i,d,x,I,S,E,_;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==s||!s.aborted){t.next=2;break}return t.abrupt("return",{v:void 0});case 2:return t.next=4,c(b(m));case 4:if(!(r=t.sent).isErr()){t.next=8;break}throw new Error("Error requesting event stream: "+r.error.message);case 8:if(r.value.response.ok&&r.value.response.body){t.next=10;break}throw new Error("Error requesting event stream: status_code="+r.value.response.status);case 10:if(n=[],o=e.createParser((function(e){if("event"===e.type&&e.data)try{var t=JSON.parse(e.data);t.eventId&&(m=t.eventId),n.push(t.data)}catch(e){f.error({error:e},"Failed parsing chunk from Dust API")}})),r.value.response.body&&"string"!=typeof r.value.response.body){t.next=14;break}throw new Error("Expected a stream response, but got a string or null");case 14:a=r.value.response.body.getReader(),i=new TextDecoder,t.prev=16;case 17:return t.next=19,c(a.read());case 19:if(I=(d=t.sent).done,!(x=d.value)){t.next=33;break}o.feed(i.decode(x,{stream:!0})),S=u(n);case 25:if((E=S()).done){t.next=32;break}return _=E.value,t.next=29,_;case 29:g.includes(_.type)&&(y=!0);case 30:t.next=25;break;case 32:n=[];case 33:if(!I){t.next=35;break}return t.abrupt("break",37);case 35:t.next=17;break;case 37:t.next=43;break;case 39:throw t.prev=39,t.t0=t.catch(16),f.error({error:t.t0},"Failed processing event stream"),new Error("Error processing event stream: "+t.t0);case 43:return t.prev=43,a.releaseLock(),t.finish(43);case 46:if(y||!h){t.next=53;break}if(!((v+=1)>=l)){t.next=50;break}throw new Error("Exceeded maximum reconnection attempts");case 50:return t.next=52,c(new Promise((function(e){return setTimeout(e,z)})));case 52:return t.abrupt("return",0);case 53:return t.abrupt("return",{v:void 0});case 54:case"end":return t.stop()}}),t,null,[[16,39,43,46]])}));case 1:return t.delegateYield(r(),"t0",3);case 3:if(0!==(n=t.t0)){t.next=6;break}return t.abrupt("continue",1);case 6:if(!n){t.next=8;break}return t.abrupt("return",n.v);case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.abrupt("return",new we({eventStream:x()}));case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.cancelMessageGeneration=function(){var e=i(p().mark((function e(t){var r,n,o,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,n=t.messageIds,e.next=3,this.request({method:"POST",path:"assistant/conversations/"+r+"/cancel",body:{messageIds:n}});case 3:return o=e.sent,e.next=6,this._resultFromResponse(an,o);case 6:if(!(s=e.sent).isErr()){e.next=11;break}return e.abrupt("return",s);case 11:return e.abrupt("return",new we(s.value));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getConversations=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"assistant/conversations"});case 2:return t=e.sent,e.next=5,this._resultFromResponse(Ar,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.conversations));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getConversation=function(){var e=i(p().mark((function e(t){var r,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,e.next=3,this.request({method:"GET",path:"assistant/conversations/"+r});case 3:return n=e.sent,e.next=6,this._resultFromResponse(zr,n);case 6:if(!(o=e.sent).isErr()){e.next=9;break}return e.abrupt("return",o);case 9:return e.abrupt("return",new we(o.value.conversation));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getConversationFeedback=function(){var e=i(p().mark((function e(t){var r,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,e.next=3,this.request({method:"GET",path:"assistant/conversations/"+r+"/feedbacks"});case 3:return n=e.sent,e.next=6,this._resultFromResponse(cr,n);case 6:if(!(o=e.sent).isErr()){e.next=9;break}return e.abrupt("return",o);case 9:return e.abrupt("return",new we(o.value.feedbacks));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.postFeedback=function(){var e=i(p().mark((function e(t,r,n){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",path:"assistant/conversations/"+t+"/messages/"+r+"/feedbacks",body:n});case 2:return e.abrupt("return",this._resultFromResponse(lr,e.sent));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.deleteFeedback=function(){var e=i(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"DELETE",path:"assistant/conversations/"+t+"/messages/"+r+"/feedbacks"});case 2:return e.abrupt("return",this._resultFromResponse(lr,e.sent));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.tokenize=function(){var e=i(p().mark((function e(t,r){var n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",path:"data_sources/"+r+"/tokenize",body:{text:t}});case 2:return n=e.sent,e.next=5,this._resultFromResponse(hr,n);case 5:if(!(o=e.sent).isErr()){e.next=8;break}return e.abrupt("return",o);case 8:return e.abrupt("return",new we(o.value.tokens));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.upsertFolder=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u,l,d,z;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.dataSourceId,n=t.folderId,o=t.timestamp,s=t.title,a=t.parentId,i=t.parents,c=t.mimeType,u=t.sourceUrl,l=t.providerVisibility,e.next=3,this.request({method:"POST",path:"data_sources/"+r+"/folders/"+encodeURIComponent(n),body:{timestamp:Math.floor(o),title:s,parent_id:a,parents:i,mime_type:c,source_url:u,provider_visibility:l}});case 3:return d=e.sent,e.next=6,this._resultFromResponse(Yr,d);case 6:if(!(z=e.sent).isErr()){e.next=9;break}return e.abrupt("return",z);case 9:return e.abrupt("return",new we(z.value));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.deleteFolder=function(){var e=i(p().mark((function e(t){var r,n,o,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.dataSourceId,n=t.folderId,e.next=3,this.request({method:"DELETE",path:"data_sources/"+r+"/folders/"+encodeURIComponent(n)});case 3:return o=e.sent,e.next=6,this._resultFromResponse(Vr,o);case 6:if(!(s=e.sent).isErr()){e.next=9;break}return e.abrupt("return",s);case 9:return e.abrupt("return",new we(s.value));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.uploadFile=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i,c,u,l,d,z,h,m,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.contentType,n=t.fileName,o=t.fileSize,s=t.useCase,a=t.useCaseMetadata,i=t.fileObject,e.next=3,this.request({method:"POST",path:"files",body:{contentType:r,fileName:n,fileSize:o,useCase:s,useCaseMetadata:a}});case 3:return c=e.sent,e.next=6,this._resultFromResponse(nn,c);case 6:if(!(u=e.sent).isErr()){e.next=9;break}return e.abrupt("return",u);case 9:return l=u.value.file,(d=new FormData).append("file",i),e.prev=12,e.next=15,this.baseHeaders();case 15:return z=e.sent,e.next=18,fetch(l.uploadUrl,{method:"POST",headers:z,body:d});case 18:if((h=e.sent).ok){e.next=24;break}return e.next=22,h.json().catch((function(){return{}}));case 22:return g=e.sent,e.abrupt("return",new ke(new Error((null==g||null==(m=g.error)?void 0:m.message)||"Failed to upload file: "+h.status)));case 24:return e.next=26,h.json();case 26:return e.abrupt("return",new we(e.sent.file));case 30:return e.prev=30,e.t0=e.catch(12),e.abrupt("return",new ke(new Error(e.t0 instanceof Error?e.t0.message:"Unknown error")));case 33:case"end":return e.stop()}}),e,this,[[12,30]])})));return function(t){return e.apply(this,arguments)}}(),r.deleteFile=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.fileID,e.next=3,this.request({method:"DELETE",path:"files/"+r});case 3:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getActiveMemberEmailsInWorkspace=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"members/emails",query:new URLSearchParams({activeOnly:"true"})});case 2:return t=e.sent,e.next=5,this._resultFromResponse(mr,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.emails));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getWorkspaceVerifiedDomains=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"verified_domains"});case 2:return t=e.sent,e.next=5,this._resultFromResponse(gr,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.verified_domains));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getWorkspaceFeatureFlags=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"feature_flags"});case 2:return t=e.sent,e.next=5,this._resultFromResponse(br,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.feature_flags));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.searchDataSourceViews=function(){var e=i(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"data_source_views/search",query:t});case 2:return r=e.sent,e.next=5,this._resultFromResponse(Rr,r);case 5:if(!(n=e.sent).isErr()){e.next=8;break}return e.abrupt("return",n);case 8:return e.abrupt("return",new we(n.value.data_source_views));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.patchDataSourceView=function(){var e=i(p().mark((function e(t,r){var n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"PATCH",path:"spaces/"+t.spaceId+"/data_source_views/"+t.sId,body:r});case 2:return n=e.sent,e.next=5,this._resultFromResponse(Pr,n);case 5:if(!(o=e.sent).isErr()){e.next=8;break}return e.abrupt("return",o);case 8:return e.abrupt("return",new we(o.value.dataSourceView));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.exportApps=function(){var e=i(p().mark((function e(t){var r,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.appSpaceId,e.next=3,this.request({method:"GET",path:"spaces/"+r+"/apps/export"});case 3:return n=e.sent,e.next=6,this._resultFromResponse(kr,n);case 6:if(!(o=e.sent).isErr()){e.next=9;break}return e.abrupt("return",o);case 9:return e.abrupt("return",new we(o.value.apps));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.checkApps=function(){var e=i(p().mark((function e(t,r){var n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",path:"spaces/"+r+"/apps/check",body:t});case 2:return n=e.sent,e.next=5,this._resultFromResponse(pn,n);case 5:if(!(o=e.sent).isErr()){e.next=8;break}return e.abrupt("return",o);case 8:return e.abrupt("return",new we(o.value.apps));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getSpaces=function(){var e=i(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"GET",path:"spaces"});case 2:return t=e.sent,e.next=5,this._resultFromResponse(dn,t);case 5:if(!(r=e.sent).isErr()){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new we(r.value.spaces));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getMCPServerViews=function(){var e=i(p().mark((function e(t,r){var n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!1),e.next=3,this.request({method:"GET",path:"spaces/"+t+"/mcp_server_views",query:new URLSearchParams({includeAuto:r.toString()})});case 3:return n=e.sent,e.next=6,this._resultFromResponse(fn,n);case 6:if(!(o=e.sent).isErr()){e.next=9;break}return e.abrupt("return",o);case 9:return e.abrupt("return",new we(o.value.serverViews));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.searchNodes=function(){var e=i(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",path:"search",body:t});case 2:return r=e.sent,e.next=5,this._resultFromResponse(Tn,r);case 5:if(!(n=e.sent).isErr()){e.next=8;break}return e.abrupt("return",n);case 8:return e.abrupt("return",new we(n.value.nodes));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.retryMessage=function(){var e=i(p().mark((function e(t){var r,n,o,s,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,n=t.messageId,s=void 0!==(o=t.blockedOnly)&&o?new URLSearchParams({blocked_only:"true"}):void 0,e.next=4,this.request({method:"POST",path:"assistant/conversations/"+r+"/messages/"+n+"/retry",query:s});case 4:return a=e.sent,e.next=7,this._resultFromResponse(dr,a);case 7:if(!(i=e.sent).isErr()){e.next=10;break}return e.abrupt("return",i);case 10:return e.abrupt("return",new we(i.value.message));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r._fetchWithError=function(){var e=i(p().mark((function e(t,r){var n,o,s,a,i,c,u,l,d,z,h,m,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=void 0===(o=(n=void 0===r?{}:r).method)?"GET":o,i=void 0===(a=n.headers)?{}:a,c=n.body,u=n.signal,d=void 0!==(l=n.stream)&&l,z=Date.now(),e.prev=2,e.next=5,fetch(t,{method:s,headers:i,body:c,signal:u});case 5:if(h=e.sent,!d||!h.body){e.next=10;break}e.t0=h.body,e.next=13;break;case 10:return e.next=12,h.text();case 12:e.t0=e.sent;case 13:return e.abrupt("return",new we({response:{status:h.status,url:h.url,body:e.t0,ok:h.ok},duration:Date.now()-z}));case 18:return e.prev=18,e.t1=e.catch(2),m=Date.now()-z,this._logger.error({dustError:g={type:"unexpected_network_error",message:"Unexpected network error from DustAPI: "+e.t1},url:t,duration:m,connectorsError:g,error:e.t1},"DustAPI error"),e.abrupt("return",new ke(g));case 24:case"end":return e.stop()}}),e,this,[[2,18]])})));return function(t,r){return e.apply(this,arguments)}}(),r.getBlockedActions=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,e.next=3,this.request({method:"GET",path:"assistant/conversations/"+r+"/actions/blocked"});case 3:return e.abrupt("return",this._resultFromResponse(Fn,e.sent));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.validateAction=function(){var e=i(p().mark((function e(t){var r,n,o,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.conversationId,n=t.messageId,o=t.actionId,s=t.approved,e.next=3,this.request({method:"POST",path:"assistant/conversations/"+r+"/messages/"+n+"/validate-action",body:{actionId:o,approved:s}});case 3:return e.abrupt("return",this._resultFromResponse(Rn,e.sent));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.registerMCPServer=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={serverName:t.serverName},e.next=4,this.request({method:"POST",path:"mcp/register",body:r});case 4:return e.abrupt("return",this._resultFromResponse(On,e.sent));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.heartbeatMCPServer=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={serverId:t.serverId},e.next=4,this.request({method:"POST",path:"mcp/heartbeat",body:r});case 4:return e.abrupt("return",this._resultFromResponse(Un,e.sent));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.postMCPResults=function(){var e=i(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={result:t.result,serverId:t.serverId},e.next=4,this.request({method:"POST",path:"mcp/results",body:r});case 4:return e.abrupt("return",this._resultFromResponse(Dn,e.sent));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getMCPRequestsConnectionDetails=function(){var e=i(p().mark((function e(t){var r,n,o,s,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serverId,n=t.lastEventId,o=this.apiUrl()+"/api/v1/w/"+this.workspaceId()+"/mcp/requests",s=new URLSearchParams(l({serverId:r},n?{lastEventId:n}:{})),e.next=5,this.baseHeaders();case 5:return a=e.sent,e.abrupt("return",new we({url:o+"?"+s.toString(),headers:a}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r._resultFromResponse=function(){var e=i(p().mark((function e(t,r){var n,o,s,a,i,c,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isErr()){e.next=2;break}return e.abrupt("return",r);case 2:if(413!==r.value.response.status){e.next=6;break}return this._logger.error({dustError:n={type:"content_too_large",message:"Your request content is too large, please try again with a shorter content."},status:r.value.response.status,url:r.value.response.url,duration:r.value.duration},"DustAPI error"),e.abrupt("return",new ke(n));case 6:return e.next=8,Wn(r.value.response);case 8:if(o=e.sent,e.prev=9,s=JSON.parse(o),!(a=t.safeParse(s)).success){e.next=16;break}return e.abrupt("return",new we(a.data));case 16:if(!(i=Pt.safeParse(s.error)).success){e.next=22;break}return this._logger.error({dustError:i.data,status:r.value.response.status,url:r.value.response.url,duration:r.value.duration},"DustAPI error"),e.abrupt("return",new ke(i.data));case 22:return this._logger.error({dustError:c={type:"unexpected_response_format",message:"Unexpected response format from DustAPI calling "+r.value.response.url+" : "+a.error.message},parseError:a.error.message,rawText:o,status:r.value.response.status,url:r.value.response.url,duration:r.value.duration},"DustAPI error"),e.abrupt("return",new ke(c));case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(9),this._logger.error({dustError:u={type:"unexpected_response_format",message:"Fail to parse response from DustAPI calling "+r.value.response.url+" : "+e.t0},error:e.t0,rawText:o,status:r.value.response.status,url:r.value.response.url,duration:r.value.duration},"DustAPI error"),e.abrupt("return",new ke(u));case 32:case"end":return e.stop()}}),e,this,[[9,27]])})));return function(t,r){return e.apply(this,arguments)}}(),t}();exports.APIErrorSchema=Pt,exports.ActionApprovalStateSchema=wn,exports.AgentConfigurationViewSchema=it,exports.AppsCheckRequestSchema=ln,exports.AppsCheckResponseSchema=pn,exports.BaseSearchBodySchema=yn,exports.BlockedActionsResponseSchema=Fn,exports.BrowseResultResourceSchema=te,exports.CONTENT_NODE_MIME_TYPES=y,exports.CancelMessageGenerationRequestSchema=cn,exports.CancelMessageGenerationResponseSchema=an,exports.ClientSideMCPServerNameSchema=jn,exports.ContentNodeSchema=In,exports.ContentNodeTypeSchema=zt,exports.ContentNodeWithParentSchema=Sn,exports.ContentNodesViewTypeSchema=ht,exports.ConversationSchema=At,exports.CoreAPIErrorSchema=jt,exports.CoreAPITokenTypeSchema=Ct,exports.CreateConversationResponseSchema=ir,exports.CreateGenericAgentConfigurationRequestSchema=or,exports.CreateGenericAgentConfigurationResponseSchema=sr,exports.DATA_SOURCE_FOLDER_SPREADSHEET_MIME_TYPE=v,exports.DATA_SOURCE_MIME_TYPE=b,exports.DATA_WAREHOUSE_MIME_TYPE=f,exports.DataSourceContentNodeSchema=En,exports.DataSourceSearchQuerySchema=Ur,exports.DataSourceViewContentNodeSchema=_n,exports.DataSourceViewResponseSchema=Pr,exports.DatabaseSchemaResourceSchema=W,exports.DeleteFolderResponseSchema=Vr,exports.DustAPI=Vn,exports.DustAppConfigTypeSchema=Lt,exports.DustAppRunBlockExecutionEventSchema=Mt,exports.DustAppRunBlockStatusEventSchema=Ft,exports.DustAppRunErroredEventSchema=Nt,exports.DustAppRunFinalEventSchema=qt,exports.DustAppRunFunctionCallArgumentsTokensEventSchema=Vt,exports.DustAppRunFunctionCallEventSchema=Wt,exports.DustAppRunReasoningItemEventSchema=Ht,exports.DustAppRunReasoningTokensEventSchema=Bt,exports.DustAppRunRunStatusEventSchema=Dt,exports.DustAppRunTokensEventSchema=Gt,exports.DustAppTypeSchema=Ut,exports.DustMcpServerTransport=Hn,exports.Err=ke,exports.ExampleRowsResourceSchema=Y,exports.ExtractQueryResourceSchema=se,exports.ExtractResultResourceSchema=ae,exports.FileTypeSchema=tn,exports.FileTypeWithUploadUrlSchema=rn,exports.FileUploadRequestResponseSchema=nn,exports.FileUploadUrlRequestSchema=Zr,exports.FileUploadedRequestResponseSchema=on,exports.GenerationTokensEventSchema=We,exports.GetActiveMemberEmailsInWorkspaceResponseSchema=mr,exports.GetAgentConfigurationsResponseSchema=nr,exports.GetAppsResponseSchema=kr,exports.GetConversationResponseSchema=zr,exports.GetConversationsResponseSchema=Ar,exports.GetDataSourcesResponseSchema=er,exports.GetFeedbacksResponseSchema=cr,exports.GetFolderResponseSchema=Wr,exports.GetFoldersResponseSchema=Hr,exports.GetMCPServerViewsQuerySchema=vn,exports.GetMCPServerViewsResponseSchema=fn,exports.GetMCPViewsRequestSchema=qn,exports.GetOrPatchAgentConfigurationResponseSchema=tr,exports.GetSpacesResponseSchema=dn,exports.GetWorkspaceFeatureFlagsResponseSchema=br,exports.GetWorkspaceUsageRequestSchema=Xr,exports.GetWorkspaceVerifiedDomainsResponseSchema=gr,exports.HeartbeatMCPResponseSchema=Un,exports.INCLUDABLE_INTERNAL_CONTENT_NODE_MIME_TYPES=x,exports.INCLUDABLE_INTERNAL_MIME_TYPES_VALUES=A,exports.INTERNAL_MIME_TYPES=E,exports.INTERNAL_MIME_TYPES_VALUES=_,exports.ImportAppsResponseSchema=Cr,exports.IncludeQueryResourceSchema=J,exports.IncludeResultResourceSchema=Z,exports.MCPProgressNotificationSchema=de,exports.MeResponseSchema=sn,exports.NotificationCanvasFileContentSchema=ce,exports.Ok=we,exports.PatchAgentConfigurationRequestSchema=rr,exports.PatchDataSourceViewRequestSchema=Or,exports.PostAppsRequestSchema=jr,exports.PostContentFragmentResponseSchema=ar,exports.PostConversationsResponseSchema=_r,exports.PostDataSourceDocumentRequestSchema=Nr,exports.PostMCPRequestsRequestQuerySchema=Nn,exports.PostMCPResultsResponseSchema=Dn,exports.PostMessageFeedbackResponseSchema=lr,exports.PostSpaceMembersRequestBodySchema=Gn,exports.PostTableParentsRequestSchema=Fr,exports.PostUserMessageResponseSchema=pr,exports.PostWorkspaceSearchResponseBodySchema=Tn,exports.ProgressNotificationContentSchema=pe,exports.ProgressNotificationOutputSchema=le,exports.PublicContentFragmentWithContentSchema=yr,exports.PublicContentFragmentWithFileIdSchema=xr,exports.PublicHeartbeatMCPRequestBodySchema=Pn,exports.PublicPostContentFragmentRequestBodySchema=Sr,exports.PublicPostConversationsRequestBodySchema=Er,exports.PublicPostEditMessagesRequestBodySchema=vr,exports.PublicPostMCPResultsRequestBodySchema=Ln,exports.PublicPostMessageFeedbackRequestBodySchema=ur,exports.PublicPostMessagesRequestBodySchema=fr,exports.PublicRegisterMCPRequestBodySchema=Cn,exports.QueryWritingInstructionsResourceSchema=V,exports.ReasoningSuccessOutputSchema=B,exports.RegisterMCPResponseSchema=On,exports.RetrievalDocumentTypeSchema=Qe,exports.RetryMessageResponseSchema=dr,exports.RunAgentQueryResourceSchema=re,exports.RunAgentResultResourceSchema=ne,exports.RunAppResponseSchema=$t,exports.SearchDataSourceViewsRequestSchema=Tr,exports.SearchDataSourceViewsResponseSchema=Rr,exports.SearchQueryResourceSchema=Q,exports.SearchRequestBodySchema=xn,exports.SearchResultResourceSchema=K,exports.SearchWarningCodeSchema=An,exports.TOOL_RUNNING_LABEL="Using a tool",exports.TokenizeResponseSchema=hr,exports.ToolsetsResultResourceSchema=oe,exports.UpsertDataSourceFolderRequestSchema=Kr,exports.UpsertDatabaseTableRequestSchema=qr,exports.UpsertFolderResponseSchema=Yr,exports.UpsertTableFromCsvRequestSchema=Mr,exports.UpsertTableRowsRequestSchema=Dr,exports.ValidateActionRequestBodySchema=kn,exports.ValidateActionResponseSchema=Rn,exports.ValidateMemberRequestSchema=wr,exports.WarningResourceSchema=X,exports.WebsearchQueryResourceSchema=$,exports.WebsearchResultResourceSchema=ee,exports.WebsearchResultSchema=rt,exports.WorkspaceDomainSchema=Ot,exports.assertNever=function(e){throw new Error(("object"==typeof e?JSON.stringify(e):e)+" is not of type never. This should never happen.")},exports.getProviderFromRetrievedDocument=un,exports.getTitleFromRetrievedDocument=function(e){if("slack"===un(e))for(var t,r=u(e.tags);!(t=r()).done;){var n=t.value;if(n.startsWith("channelName:"))return"#"+n.substring(12)}for(var o,s=u(e.tags);!(o=s()).done;){var a=o.value;if(a.startsWith("title:"))return a.substring(6)}return e.documentId},exports.isAgentMention=function(e){return void 0!==e.configurationId},exports.isBrowseResultResourceType=function(e){return"resource"===e.type&&te.safeParse(e.resource).success},exports.isCanvasFileContentOutput=function(e){return void 0!==e&&"canvas_file"===e.type},exports.isConnectorProvider=function(e){return Ce.safeParse(e).success},exports.isConnectorsAPIError=function(e){return"object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message&&"type"in e&&"string"==typeof e.type&&be.safeParse(e).success},exports.isDatabaseSchemaResourceType=function(e){return"resource"===e.type&&W.safeParse(e.resource).success},exports.isDustMimeType=function(e){return _.includes(e)},exports.isExampleRowsResourceType=function(e){return"resource"===e.type&&Y.safeParse(e.resource).success},exports.isExtractQueryResourceType=function(e){return"resource"===e.type&&se.safeParse(e.resource).success},exports.isExtractResultResourceType=function(e){return"resource"===e.type&&ae.safeParse(e.resource).success},exports.isFolder=function(e){return!e.connectorProvider},exports.isImageProgressOutput=function(e){return void 0!==e&&"image"===e.type},exports.isIncludableInternalMimeType=function(e){return A.includes(e)},exports.isIncludeQueryResourceType=function(e){return"resource"===e.type&&J.safeParse(e.resource).success},exports.isIncludeResultResourceType=function(e){return"resource"===e.type&&Z.safeParse(e.resource).success},exports.isMCPProgressNotificationType=function(e){return de.safeParse(e).success},exports.isMCPServerPersonalAuthRequiredError=function(e){return"mcp_server_personal_authentication_required"===e.code&&e.metadata&&"mcpServerId"in e.metadata},exports.isQueryWritingInstructionsResourceType=function(e){return"resource"===e.type&&V.safeParse(e.resource).success},exports.isReasoningSuccessOutput=function(e){return"resource"===e.type&&B.safeParse(e.resource).success},exports.isResourceWithName=function(e){return"name"in e&&"string"==typeof e.name},exports.isRunAgentQueryResourceType=function(e){return"resource"===e.type&&re.safeParse(e.resource).success},exports.isRunAgentResultResourceType=function(e){return"resource"===e.type&&ne.safeParse(e.resource).success},exports.isSearchQueryResourceType=function(e){return"resource"===e.type&&Q.safeParse(e.resource).success},exports.isSearchResultResourceType=function(e){return"resource"===e.type&&K.safeParse(e.resource).success},exports.isSqlQueryOutput=function(e){return"resource"===e.type&&H.safeParse(e.resource).success},exports.isSupportedFileContentType=function(e){return Ee.includes(e)},exports.isSupportedImageContentType=function(e){return Ie.includes(e)},exports.isSupportedPlainTextContentType=function(e){return xe.includes(e)},exports.isThinkingOutput=function(e){return"resource"===e.type&&G.safeParse(e.resource).success},exports.isToolGeneratedFile=function(e){return"resource"===e.type&&q.safeParse(e.resource).success},exports.isToolsetsResultResourceType=function(e){return"resource"===e.type&&oe.safeParse(e.resource).success},exports.isWarningResourceType=function(e){return"resource"===e.type&&X.safeParse(e.resource).success},exports.isWebsearchQueryResourceType=function(e){return"resource"===e.type&&$.safeParse(e.resource).success},exports.isWebsearchResultResourceType=function(e){return"resource"===e.type&&ee.safeParse(e.resource).success},exports.isWebsite=function(e){return"webcrawler"===e.connectorProvider},exports.removeNulls=function(e){return e.filter((function(e){return null!=e}))},exports.supportedFileExtensions=Se,exports.supportedImageFileFormats=ye,exports.supportedOtherFileFormats=ve;
//# sourceMappingURL=client.cjs.production.min.js.map
